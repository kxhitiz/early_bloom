<div class="max-w-3xl mx-auto">
  <div class="mb-8">
    <h1 class="text-2xl sm:text-3xl font-bold text-emerald-700 mb-2">Feature Requests</h1>
    <p class="text-stone-600">Help us improve Early Bloom! Share your ideas and vote on features you'd love to see.</p>
  </div>

  <div class="bg-white p-4 sm:p-6 rounded-lg shadow-sm border border-stone-200 mb-8">
    <h2 class="text-lg font-semibold text-stone-800 mb-4">Suggest a Feature</h2>

    <%= form_with model: @new_feature_request, url: feature_requests_path, class: "space-y-4" do |f| %>
      <% if @new_feature_request.errors.any? %>
        <div class="p-4 bg-red-50 border border-red-200 text-red-800 rounded-lg">
          <ul class="list-disc list-inside">
            <% @new_feature_request.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <% unless logged_in? %>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :guest_name, "Your Name", class: "block text-sm font-medium text-stone-700 mb-1" %>
            <%= f.text_field :guest_name, class: "w-full px-4 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500", placeholder: "Your name" %>
          </div>
          <div>
            <%= f.label :guest_email, "Email (optional)", class: "block text-sm font-medium text-stone-700 mb-1" %>
            <%= f.email_field :guest_email, class: "w-full px-4 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500", placeholder: "For updates on your request" %>
          </div>
        </div>
      <% end %>

      <div>
        <%= f.label :title, "Feature Title", class: "block text-sm font-medium text-stone-700 mb-1" %>
        <%= f.text_field :title, class: "w-full px-4 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500", placeholder: "e.g., Dark mode support" %>
      </div>

      <div>
        <%= f.label :description, "Description", class: "block text-sm font-medium text-stone-700 mb-1" %>
        <%= f.text_area :description, rows: 3, class: "w-full px-4 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500", placeholder: "Describe the feature and why it would be helpful..." %>
      </div>

      <%= f.submit "Submit Request", class: "px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-semibold cursor-pointer" %>
    <% end %>
  </div>

  <% unless logged_in? %>
    <div class="bg-emerald-50 border border-emerald-200 p-4 rounded-lg mb-6">
      <p class="text-emerald-800">
        <%= link_to "Login", login_path, class: "font-semibold hover:underline" %> to vote on feature requests.
      </p>
    </div>
  <% end %>

  <div class="space-y-4">
    <h2 class="text-lg font-semibold text-stone-800">Community Requests</h2>

    <% if @feature_requests.any? %>
      <% @feature_requests.each do |request| %>
        <div class="bg-white p-4 sm:p-5 rounded-lg shadow-sm border border-stone-200 flex gap-4">
          <div class="flex flex-col items-center">
            <% if logged_in? %>
              <%= button_to vote_feature_request_path(request), method: :post, class: "flex flex-col items-center group" do %>
                <svg class="w-6 h-6 <%= request.voted_by?(current_user) ? 'text-emerald-600' : 'text-stone-400 group-hover:text-emerald-500' %>" fill="<%= request.voted_by?(current_user) ? 'currentColor' : 'none' %>" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                </svg>
                <span class="text-sm font-semibold <%= request.voted_by?(current_user) ? 'text-emerald-600' : 'text-stone-600' %>"><%= request.votes_count %></span>
              <% end %>
            <% else %>
              <div class="flex flex-col items-center">
                <svg class="w-6 h-6 text-stone-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                </svg>
                <span class="text-sm font-semibold text-stone-600"><%= request.votes_count %></span>
              </div>
            <% end %>
          </div>

          <div class="flex-1 min-w-0">
            <div class="flex items-start justify-between gap-2 mb-1">
              <h3 class="font-semibold text-stone-800"><%= request.title %></h3>
              <% if request.status != "pending" %>
                <span class="text-xs px-2 py-1 rounded-full font-medium flex-shrink-0
                  <%= case request.status
                      when 'planned' then 'bg-blue-100 text-blue-700'
                      when 'in_progress' then 'bg-amber-100 text-amber-700'
                      when 'completed' then 'bg-emerald-100 text-emerald-700'
                      else 'bg-stone-100 text-stone-600'
                      end %>">
                  <%= request.status.titleize %>
                </span>
              <% end %>
            </div>
            <p class="text-sm text-stone-600 mb-2"><%= request.description %></p>
            <p class="text-xs text-stone-400">
              by <%= request.author_name %> Â· <%= time_ago_in_words(request.created_at) %> ago
            </p>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="bg-white p-8 rounded-lg shadow-sm border border-stone-200 text-center">
        <p class="text-stone-500">No feature requests yet. Be the first to suggest one!</p>
      </div>
    <% end %>
  </div>
</div>
