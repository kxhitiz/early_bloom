<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Early Bloom - A Safe Space for New Parents" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%= favicon_link_tag "favicon.svg", type: "image/svg+xml" %>
    <%= favicon_link_tag "favicon.svg", rel: "apple-touch-icon", type: "image/svg+xml" %>

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
    <%= render 'shared/analytics' if Rails.env.production? %>
  </head>

  <body class="bg-stone-50 text-stone-800 min-h-screen">
    <header class="bg-white border-b border-stone-200 shadow-sm" data-controller="menu">
      <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
        <%= link_to root_path, class: "flex items-center hover:opacity-90 transition flex-shrink-0" do %>
          <span class="sm:hidden font-['Pacifico'] text-xl text-emerald-600">Early Bloom</span>
          <svg width="280" height="80" viewBox="0 0 280 80" xmlns="http://www.w3.org/2000/svg" class="hidden sm:block h-10 w-auto">
            <text x="140" y="45" font-family="Pacifico, cursive" font-size="42" fill="#059669" text-anchor="middle">Early Bloom</text>
            <line x1="60" y1="50" x2="220" y2="50" stroke="#fda4af" stroke-width="1" opacity="0.3"></line>
            <text x="140" y="68" font-family="system-ui, sans-serif" font-size="10" fill="#78716c" text-anchor="middle" letter-spacing="1.5">A SAFE SPACE FOR NEW PARENTS</text>
          </svg>
        <% end %>

        <!-- Desktop Nav -->
        <nav class="hidden sm:flex items-center gap-4">
          <% if logged_in? %>
            <%= link_to "Feed", feed_path, class: "text-stone-600 hover:text-emerald-700" %>
            <%= link_to "New Post", new_post_path, class: "text-stone-600 hover:text-emerald-700" %>
            <%= link_to user_path(current_user), class: "flex items-center gap-2 text-stone-600 hover:text-emerald-700" do %>
              <div class="w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-700 font-semibold text-sm">
                <%= current_user.name.first.upcase %>
              </div>
              <span class="text-sm"><%= current_user.name %></span>
            <% end %>
            <%= button_to "Logout", logout_path, method: :delete, class: "text-sm px-3 py-1 bg-stone-200 hover:bg-stone-300 rounded" %>
          <% else %>
            <%= link_to "Browse Posts", posts_path, class: "text-stone-600 hover:text-emerald-700" %>
            <%= link_to "Login", login_path, class: "text-stone-600 hover:text-emerald-700" %>
            <%= link_to "Sign Up", signup_path, class: "px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg" %>
          <% end %>
        </nav>

        <!-- Mobile Hamburger Button -->
        <button type="button" class="sm:hidden p-2 text-stone-600 hover:text-emerald-700" data-action="click->menu#toggle">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path data-menu-target="openIcon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            <path data-menu-target="closeIcon" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Menu -->
      <nav data-menu-target="menu" class="hidden sm:hidden border-t border-stone-100 bg-white">
        <div class="max-w-5xl mx-auto px-4 py-3 flex flex-col gap-3">
          <% if logged_in? %>
            <%= link_to user_path(current_user), class: "flex items-center gap-3 py-2 text-stone-700" do %>
              <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-700 font-semibold">
                <%= current_user.name.first.upcase %>
              </div>
              <span class="font-medium"><%= current_user.name %></span>
            <% end %>
            <div class="border-t border-stone-100 pt-3 flex flex-col gap-2">
              <%= link_to "Feed", feed_path, class: "py-2 text-stone-600 hover:text-emerald-700" %>
              <%= link_to "New Post", new_post_path, class: "py-2 text-stone-600 hover:text-emerald-700" %>
              <%= link_to "Feature Requests", feature_requests_path, class: "py-2 text-stone-600 hover:text-emerald-700" %>
              <%= button_to "Logout", logout_path, method: :delete, class: "py-2 text-left text-stone-600 hover:text-emerald-700" %>
            </div>
          <% else %>
            <%= link_to "Browse Posts", posts_path, class: "py-2 text-stone-600 hover:text-emerald-700" %>
            <%= link_to "Login", login_path, class: "py-2 text-stone-600 hover:text-emerald-700" %>
            <%= link_to "Sign Up", signup_path, class: "py-2 px-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-center" %>
          <% end %>
        </div>
      </nav>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-8">
      <% if flash[:notice] %>
        <div class="mb-6 p-4 bg-emerald-50 border border-emerald-200 text-emerald-800 rounded-lg">
          <%= flash[:notice] %>
        </div>
      <% end %>
      
      <% if flash[:alert] %>
        <div class="mb-6 p-4 bg-amber-50 border border-amber-200 text-amber-800 rounded-lg">
          <%= flash[:alert] %>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <footer class="bg-white border-t border-stone-200 mt-16 py-8">
      <div class="max-w-5xl mx-auto px-4 text-center">
        <div class="flex justify-center mb-3">
          <svg width="48" height="48" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" class="h-8 w-auto opacity-60">
            <text x="24" y="32" font-family="Pacifico, cursive" font-size="24" fill="#059669" text-anchor="middle">EB</text>
          </svg>
        </div>
        <p class="text-stone-500 text-sm">Early Bloom - A calm, supportive space for new parents</p>
        <p class="mt-2 text-stone-400 text-xs">Remember: You're not alone, and you're doing great.</p>
        <div class="mt-4">
          <%= link_to "Feature Requests", feature_requests_path, class: "text-sm text-emerald-600 hover:text-emerald-700" %>
        </div>
      </div>
    </footer>
  </body>
</html>
